{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="position-relative w-100 overflow-hidden shadow mb-5" style="height: 600px;">
    <div class="position-absolute top-0 start-0 w-100 h-100" 
         style="background-image: url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?ixlib=rb-4.0.3&auto=format&fit=crop&w=1932&q=80'); 
                background-size: cover; background-position: center;">
    </div>
    <div class="position-absolute top-0 start-0 w-100 h-100" style="background: linear-gradient(to right, rgba(33, 37, 41, 0.9), rgba(33, 37, 41, 0.4));"></div>

    <div class="position-relative h-100 container d-flex flex-column justify-content-center text-white p-5">
        <span class="text-uppercase tracking-widest mb-3 fw-bold" style="letter-spacing: 3px; font-size: 0.9rem; color: #4ade80; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">
            Gestión Inmobiliaria & Topografía
        </span>
        <h1 class="display-3 fw-bold mb-4" style="max-width: 800px; text-shadow: 0 2px 10px rgba(0,0,0,0.5);">
            Expertos en Tierra<br>
        </h1>
        <p class="fs-5 mb-5 text-light opacity-90" style="max-width: 650px; line-height: 1.6;">
           Servicios Integrales de Topografía y Corretaje de propiedades en Tomé y alrededores.
        </p>
        <div class="d-flex gap-3 flex-column flex-sm-row">
            <a href="#servicios-resumen" class="btn btn-success btn-lg fw-bold rounded-pill shadow px-4">
                Nuestros Servicios
            </a>
            <a href="{% url 'catalogo' %}" class="btn btn-outline-light btn-lg fw-bold rounded-pill px-4">
                Ver Propiedades
            </a>
        </div>
    </div>
</div>

<div class="container mb-5" id="servicios-resumen">
    <div class="text-center mb-5">
        <h6 class="text-success fw-bold text-uppercase ls-2 small">Lo que hacemos</h6>
        <h2 class="fw-bold text-technical">Soluciones Integrales para tu Terreno</h2>
    </div>

    <div class="row g-4">
        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm hover-lift text-center p-4">
                <div class="mx-auto mb-3 bg-light rounded-circle d-flex align-items-center justify-content-center text-success" style="width: 80px; height: 80px;">
                    <i class="bi bi-house-door-fill fs-2"></i>
                </div>
                <h5 class="fw-bold text-technical">Corretaje de Propiedades</h5>
                <p class="text-muted small">Compra, venta y administración con un enfoque técnico. Buscamos entender tus necesidades y nos adaptamos a ellas.</p>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm hover-lift text-center p-4">
                <div class="mx-auto mb-3 bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 80px; height: 80px; color: #2980b9;">
                    <i class="bi bi-layers-half fs-2"></i>
                </div>
                <h5 class="fw-bold text-technical">Topografía e Ingeniería</h5>
                <p class="text-muted small">Levantamientos, subdivisiones urbanas y rurales, fotogrametría con drones y cubicaciones.</p>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm hover-lift text-center p-4">
                <div class="mx-auto mb-3 bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 80px; height: 80px; color: #8e44ad;">
                    <i class="bi bi-file-earmark-text fs-2"></i>
                </div>
                <h5 class="fw-bold text-technical">Legal y Regularización</h5>
                <p class="text-muted small">Estudio de títulos, saneamiento de terrenos, posesiones efectivas y trámites en CBR.</p>
            </div>
        </div>

        <div class="col-md-6 col-lg-3">
            <div class="card h-100 border-0 shadow-sm hover-lift text-center p-4">
                <div class="mx-auto mb-3 bg-light rounded-circle d-flex align-items-center justify-content-center" style="width: 80px; height: 80px; color: #d35400;">
                    <i class="bi bi-graph-up-arrow fs-2"></i>
                </div>
                <h5 class="fw-bold text-technical">Tasaciones</h5>
                <p class="text-muted small">Valoración comercial y agrícola real. Conoce el precio justo de tu patrimonio basado en datos de mercado.</p>
            </div>
        </div>
    </div>
    
    <div class="text-center mt-5">
        <a href="{% url 'servicios' %}" class="btn btn-outline-dark rounded-pill px-4">Conocer todos los detalles <i class="bi bi-arrow-right ms-2"></i></a>
    </div>
</div>

<div class="position-relative py-5 mb-5 overflow-hidden" id="stats-section" style="background-color: #2C3E50;">
    
    <div class="position-relative top-0 start-0 w-100 h-100 position-absolute" 
         style="background-image: url('https://images.unsplash.com/photo-1542744173-8e7e53415bb0?auto=format&fit=crop&q=80&w=1920'); 
                background-size: cover; background-position: center; opacity: 0.3;">
    </div>
    
    <div class="position-absolute top-0 start-0 w-100 h-100" 
         style="background: linear-gradient(to right, rgba(44, 62, 80, 0.95), rgba(44, 62, 80, 0.85));">
    </div>

    <div class="container position-relative py-4">
        <div class="row g-4 justify-content-center">
            
            <div class="col-md-4">
                <div class="p-4 text-center rounded-4 h-100 border border-white border-opacity-10 shadow-sm hover-lift" 
                     style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(5px);">
                    
                    <div class="mb-3 d-inline-flex align-items-center justify-content-center rounded-circle bg-success bg-opacity-25" style="width: 60px; height: 60px;">
                        <i class="bi bi-calendar-check text-success fs-3"></i>
                    </div>
                    
                    <div class="d-flex justify-content-center align-items-baseline text-white">
                        <span class="display-5 fw-bold me-1">+</span>
                        <h2 class="display-5 fw-bold mb-0 counter-value" data-target="30">0</h2>
                    </div>
                    
                    <p class="text-white-50 text-uppercase small fw-bold mt-2 ls-1 mb-0">
                        Años de Experiencia<br>Topográfica
                    </p>
                </div>
            </div>

            <div class="col-md-4">
                <div class="p-4 text-center rounded-4 h-100 border border-white border-opacity-10 shadow-sm hover-lift"
                     style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(5px);">
                    
                    <div class="mb-3 d-inline-flex align-items-center justify-content-center rounded-circle bg-primary bg-opacity-25" style="width: 60px; height: 60px;">
                        <i class="bi bi-folder-check text-primary fs-3"></i>
                    </div>
                    
                    <div class="d-flex justify-content-center align-items-baseline text-white">
                        <span class="display-5 fw-bold me-1">+</span>
                        <h2 class="display-5 fw-bold mb-0 counter-value" data-target="500">0</h2>
                    </div>
                    
                    <p class="text-white-50 text-uppercase small fw-bold mt-2 ls-1 mb-0">
                        Proyectos<br>Realizados
                    </p>
                </div>
            </div>

            <div class="col-md-4">
                <div class="p-4 text-center rounded-4 h-100 border border-white border-opacity-10 shadow-sm hover-lift"
                     style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(5px);">
                    
                    <div class="mb-3 d-inline-flex align-items-center justify-content-center rounded-circle bg-warning bg-opacity-25" style="width: 60px; height: 60px;">
                        <i class="bi bi-geo-alt text-warning fs-3"></i>
                    </div>
                    
                    <div class="d-flex justify-content-center align-items-baseline text-white">
                        <span class="display-5 fw-bold me-1">+</span>
                        <h2 class="display-5 fw-bold mb-0 counter-value" data-target="12">0</h2>
                    </div>
                    
                    <p class="text-white-50 text-uppercase small fw-bold mt-2 ls-1 mb-0">
                        Años operando<br>en la Zona
                    </p>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
    .hover-lift { transition: transform 0.2s ease, box-shadow 0.2s ease; }
    .hover-lift:hover { transform: translateY(-5px); box-shadow: 0 .5rem 1rem rgba(0,0,0,.15)!important; }
</style>

<script>
    // LÓGICA DE CONTADOR ANIMADO
    document.addEventListener("DOMContentLoaded", () => {
        const counters = document.querySelectorAll('.counter-value');
        const speed = 200; // Mientras más alto, más lento

        // Función que anima un contador específico
        const animateCounter = (counter) => {
            const updateCount = () => {
                const target = +counter.getAttribute('data-target'); // El número final
                const count = +counter.innerText; // El número actual
                
                // Calculamos cuánto sumar en cada paso para que todos terminen al mismo tiempo
                const inc = target / speed;

                if (count < target) {
                    // Si es decimal (ej: 12.5), redondeamos hacia arriba
                    counter.innerText = Math.ceil(count + inc);
                    setTimeout(updateCount, 20); // Velocidad de refresco (ms)
                } else {
                    counter.innerText = target; // Asegurar que termine en el número exacto
                }
            };
            updateCount();
        };

        // OBSERVADOR: Solo inicia la animación cuando el usuario ve la sección
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.5 // Se activa cuando el 50% de la sección es visible
        };

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    // Encontramos los contadores DENTRO de la sección visible
                    const sectionCounters = entry.target.querySelectorAll('.counter-value');
                    sectionCounters.forEach(counter => animateCounter(counter));
                    
                    // Dejamos de observar para que no se repita al subir y bajar
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        // Empezar a observar la sección de estadísticas
        const statsSection = document.getElementById('stats-section');
        if (statsSection) {
            observer.observe(statsSection);
        }
    });
</script>

<style>
    .hover-lift {
        transition: transform 0.3s ease, background-color 0.3s ease;
        cursor: default; /* O pointer si quieres que parezca clicable */
    }
    .hover-lift:hover {
        transform: translateY(-5px); /* Sube 5 pixeles */
        background-color: rgba(255, 255, 255, 0.15) !important; /* Se ilumina un poco */
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // 1. Leer si venimos mandados desde el modal
        const params = new URLSearchParams(window.location.search);
        const action = params.get('preselect');

        if (action === 'comprar') {
            // Esperamos un poquito para asegurar que el HTML cargó
            setTimeout(() => {
                console.log("Automatizando Wizard...");

                // PASO 1: Clic en 'Operaciones Inmobiliarias'
                // Buscamos el botón por su función onclick, es lo más seguro
                const btnInmo = document.querySelector("button[onclick*='inmobiliaria']");
                
                if (btnInmo) {
                    btnInmo.click(); // Esto despliega el paso 2

                    // PASO 2: Esperar a que aparezcan las opciones y elegir 'Comprar'
                    setTimeout(() => {
                        const step2 = document.getElementById('step-2');
                        const buttons = step2.querySelectorAll('button');
                        
                        // Buscamos el botón que tenga la palabra "Comprar"
                        for (let btn of buttons) {
                            if (btn.innerText.toLowerCase().includes('comprar')) {
                                btn.click(); // Esto despliega el formulario final
                                
                                // Hacemos scroll suave hacia el formulario final
                                document.getElementById('step-4').scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });
                                break;
                            }
                        }
                    }, 400); // 400ms de espera para la animación
                }
            }, 300);
        }
    });
</script>

{% endblock %}